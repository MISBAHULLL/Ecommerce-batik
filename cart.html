<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keranjang Belanja - Batik Indonesia</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navbar Container -->
    <div id="navbar-container"></div>

    <!-- Header Container -->
    <div id="header-container"></div>

    <main>
        <!-- Cart Content -->
        <section class="py-5">
            <div class="container">
                <div class="row">
                    <!-- Cart Items -->
                    <div class="col-lg-8">
                        <div id="cartItems">
                            <!-- Item keranjang akan dimuat dari JavaScript -->
                        </div>
                        
                        <!-- Empty Cart Message -->
                        <div id="emptyCart" class="text-center py-5" style="display: none;">
                            <i class="bi bi-cart-x display-1 text-muted"></i>
                            <h3 class="mt-3">Keranjang Belanja Kosong</h3>
                            <p class="text-muted mb-4">Belum ada produk di keranjang belanja Anda</p>
                            <a href="products.html" class="btn btn-primary">
                                <i class="bi bi-bag me-2"></i>Mulai Belanja
                            </a>
                        </div>
                    </div>
                    
                    <!-- Cart Summary -->
                    <div class="col-lg-4">
                        <div class="card" id="cartSummary" style="display: none;">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-receipt me-2"></i>Ringkasan Belanja
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-3">
                                    <span>Total Item:</span>
                                    <span id="totalItems">0 item</span>
                                </div>
                                <div class="d-flex justify-content-between mb-3">
                                    <span>Subtotal:</span>
                                    <span id="subtotal">Rp 0</span>
                                </div>
                                <div class="d-flex justify-content-between mb-3">
                                    <span>Ongkos Kirim:</span>
                                    <span class="text-success">Gratis</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between mb-4">
                                    <strong>Total:</strong>
                                    <strong id="totalPrice" class="text-primary">Rp 0</strong>
                                </div>
                                <button class="btn btn-primary w-100 mb-3" onclick="checkout()">
                                    <i class="bi bi-credit-card me-2"></i>Checkout
                                </button>
                                <button class="btn btn-outline-danger w-100" onclick="clearCart()">
                                    <i class="bi bi-trash me-2"></i>Kosongkan Keranjang
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/data.js"></script>
    <script src="js/cart-simple.js"></script>
    <script src="js/components.js"></script>
    <script>
        // Load komponen halaman
        document.addEventListener('DOMContentLoaded', function() {
            // Load navbar, header, dan footer
            loadComponents('cart', 'Keranjang Belanja', 'Review produk yang akan Anda beli');
            
            // Load keranjang
            loadCartItems();
        });
        
        // Load dan tampilkan item keranjang
        function loadCartItems() {
            const cartItems = window.cart.getCart();
            const cartContainer = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            const cartSummary = document.getElementById('cartSummary');
            
            if (cartItems.length === 0) {
                cartContainer.innerHTML = '';
                emptyCart.style.display = 'block';
                cartSummary.style.display = 'none';
                return;
            }
            
            emptyCart.style.display = 'none';
            cartSummary.style.display = 'block';
            
            const itemsHTML = cartItems.map(item => `
                <div class="card mb-3">
                    <div class="row g-0">
                        <div class="col-md-3">
                            <img src="${item.image}" class="img-fluid rounded-start h-100" alt="${item.name}" style="object-fit: cover;">
                        </div>
                        <div class="col-md-9">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5 class="card-title">${item.name}</h5>
                                        <p class="card-text">
                                            <small class="text-muted">Harga: ${formatPrice(item.price)}</small>
                                        </p>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Jumlah:</label>
                                        <div class="input-group">
                                            <button class="btn btn-outline-secondary btn-sm" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                            <input type="number" class="form-control form-control-sm text-center" value="${item.quantity}" min="1" onchange="updateQuantity(${item.id}, this.value)">
                                            <button class="btn btn-outline-secondary btn-sm" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                                        </div>
                                    </div>
                                    <div class="col-md-3 text-end">
                                        <p class="mb-2">
                                            <strong>Subtotal:</strong><br>
                                            <span class="text-primary fs-5">${formatPrice(item.price * item.quantity)}</span>
                                        </p>
                                        <button class="btn btn-danger btn-sm" onclick="removeItem(${item.id})">
                                            <i class="bi bi-trash"></i> Hapus
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            cartContainer.innerHTML = itemsHTML;
            updateCartSummary();
        }
        
        // Update ringkasan keranjang
        function updateCartSummary() {
            const total = window.cart.getTotal();
            const totalItems = window.cart.getTotalItems();
            
            document.getElementById('totalItems').textContent = `${totalItems} item${totalItems > 1 ? 's' : ''}`;
            document.getElementById('subtotal').textContent = formatPrice(total);
            document.getElementById('totalPrice').textContent = formatPrice(total);
        }
        
        // Update jumlah item
        function updateQuantity(productId, newQuantity) {
            const quantity = parseInt(newQuantity);
            if (quantity < 1) {
                removeItem(productId);
                return;
            }
            
            window.cart.updateQuantity(productId, quantity);
            loadCartItems();
        }
        
        // Hapus item dari keranjang
        function removeItem(productId) {
            if (confirm('Apakah Anda yakin ingin menghapus item ini dari keranjang?')) {
                window.cart.removeFromCart(productId);
                loadCartItems();
            }
        }
        
        // Kosongkan seluruh keranjang
        function clearCart() {
            if (confirm('Apakah Anda yakin ingin mengosongkan seluruh keranjang?')) {
                window.cart.clearCart();
                loadCartItems();
            }
        }
        
        // Proses checkout
        function checkout() {
            const cartItems = window.cart.getCart();
            const total = window.cart.getTotal();
            
            if (cartItems.length === 0) {
                alert('Keranjang belanja kosong!');
                return;
            }
            
            const confirmed = confirm(`Total belanja: ${formatPrice(total)}\n\nLanjutkan ke pembayaran?`);
            
            if (confirmed) {
                alert('Terima kasih! Pesanan Anda sedang diproses.\n\nAnda akan dihubungi untuk konfirmasi pembayaran.');
                window.cart.clearCart();
                loadCartItems();
            }
        }
    </script>
</body>
</html>